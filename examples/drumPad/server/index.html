<!DOCTYPE html>  
<html>
<head>
  <title>KISA Part 6 (Keep It Simple Audio)</title>
   <!-- xxscript type="text/javascript" src="http://processingjs.org/js/processing.min.js"></script>-->
   <script type="text/javascript" src="http://processingjs.org/js/processing.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/jquery-migrate-1.1.1.min.js"></script>
    <script>
    window.addEventListener('load', function () {
          var p;
          var selectOption;
          var remote_IP_port = "ws://192.168.1.202:1337";
          ws = new WebSocket(remote_IP_port);
          p = Processing.getInstanceById('daft');

          
          ws.onopen = function(ev) {
            console.log('Connection opened with '+ remote_IP_port);
          }
          
          ws.onmessage = function(ev) {
            console.log(ev.data);
            switch(ev.data) {
              case 'play':
                JSPlay();
                console.log('Play from server: ' + ev.data);
                break;
              case 'stop':
                JSStop();
                console.log('Stop from server: ' + ev.data);
                break;
              case 'harder':
                JSHarder(); 
                console.log('Harder');
                break;
              default:
                break;
            }
          }

          ws.onclose = function(ev) {
            console.log('Connection closed.');
          }
          ws.onerror = function(ev) {
            console.log('An error occurred. Sorry for that.');
          }

          WebSocket.prototype.sendMessage = function(msg) {
             this.send(msg);
             console.log('Message sent: ' + msg);
          }
          
          function JSHarder() {
            switchSketchState('harder');
          }

          function JSPlay(){
            switchSketchState(3);
          }

          function JSStop(){
            switchSketchState(-1);
          }

          function JSLoad(){
            switchSketchState(0);
          }

          function switchSketchState(num) {
            if (!p) {
                  p = Processing.getInstanceById('daft');
            }

            switch(num) {
              case (num > 0) :
                p.play(0);
                break;
              case (num < 0) :
                p.stop();
                break;
              case (num == 0):
                p.play(p.load(p.getSoundFiles()[9]));  
                break;
              default:
                break;
            }
          } 
    });
    </script>
</head>
<body>
  
  <canvas id="daft" data-processing-sources="players.pde Display.pde CircleButton.pde">
      Your browser does not support HTML 5.  You may want to update your
      browser.
  </canvas> 
  <div id="player">  
      <button onclick="JSPlay()">Play</button>
      
      <button onclick="JSStop()">Stop</button>
      
      <button onclick="JSLoad()">Load</button>

  </div>
</body>
</html>
